{% extends "base.html" %}

{% block title %}Documents{% endblock %}

{% block content %}
<h2>Documents List</h2>

<div class="documents-container">
    {% for doc in documents %}
    <div class="document-card">
        <p><strong>{{ doc.title }}</strong> (v{{ doc.version }})</p>
        <p>Tags: {{ doc.tags }}</p>
        <p>Uploaded by: {{ doc.uploader.username }} on {{ doc.upload_date.strftime('%Y-%m-%d %H:%M') }}</p>

        <div class="doc-actions">
            <a href="{{ url_for('download', doc_id=doc.id) }}" class="btn btn-primary btn-sm">Download</a>

            {% if current_user.is_authenticated %}
                {% if current_user.id == doc.uploader_id or current_user.role == 'admin' %}
                    <a href="{{ url_for('update_document', doc_id=doc.id) }}" class="btn btn-warning btn-sm">Edit</a>
                    <form action="{{ url_for('delete_document', doc_id=doc.id) }}" method="post" style="display:inline;">
                        {{ form.hidden_tag() }}
                        <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirm('Are you sure you want to delete this document?');">
                            Delete
                        </button>
                    </form>
                {% endif %}
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="pagination">
    {% for p in range(1, total_pages+1) %}
        {% if p == page %}
            <span class="current-page">{{ p }}</span>
        {% else %}
            <a href="{{ url_for('documents', page=p) }}">{{ p }}</a>
        {% endif %}
    {% endfor %}
</div>
{% endif %}

<br>
<a href="{{ url_for('upload') }}" class="btn btn-success">Upload New Document</a>
<a href="{{ url_for('home') }}" class="btn btn-primary">Back to Home</a>
{% endblock %}
